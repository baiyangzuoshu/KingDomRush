{"version":3,"sources":["assets\\Scripts\\ECS\\Systems\\AISystem.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,4EAA4E;AAC5E,mBAAmB;AACnB,sFAAsF;AACtF,8BAA8B;AAC9B,sFAAsF;;;;;;;;;;;;;;;;;;;;;AAEtF,8DAAyD;AAMnD,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAsC,4BAAY;IAAlD;;IAiCA,CAAC;iBAjCoB,QAAQ;IAGzB,yBAAM,GAAN;QACI,IAAG,IAAI,KAAG,UAAQ,CAAC,SAAS,EAAC;YACzB,UAAQ,CAAC,SAAS,GAAC,IAAI,CAAA;SAC1B;aACG;YACA,IAAI,CAAC,OAAO,EAAE,CAAA;YACd,OAAM;SACT;IACL,CAAC;IAEa,oBAAW,GAAzB;QACI,OAAO,UAAQ,CAAC,SAAS,CAAC;IAC9B,CAAC;IAED,2BAAQ,GAAR,UAAS,EAAS,EAAC,uBAA0C,EAAC,kBAAgC,EAAC,oBAAoC,EAC/H,kBAAkB,EAAC,uBAA0C,EAAC,kBAAgC;QAE9F,IAAI,GAAG,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAA;QACzE,IAAI,QAAQ,GAAG,yBAAe,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC;QACvG,IAAI,GAAG,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAA;QACzE,IAAI,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACvB,IAAI,QAAQ,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,EAAE;YACzB,KAAK;YACL,oBAAoB,CAAC,UAAU,GAAC,GAAG,CAAC;YACpC,oBAAoB,CAAC,OAAO,GAAG,kBAAkB,CAAC,QAAQ,CAAC;YAC3D,OAAO,CAAC,GAAG,CAAC,8BAA8B,EAAC,kBAAkB,CAAC,QAAQ,CAAC,CAAA;YACvE,OAAO,IAAI,CAAA;SACd;QACD,OAAO,KAAK,CAAA;IAChB,CAAC;;IA9Bc,kBAAS,GAAU,IAAI,CAAA;IAFrB,QAAQ;QAD5B,OAAO;OACa,QAAQ,CAiC5B;IAAD,eAAC;CAjCD,AAiCC,CAjCqC,EAAE,CAAC,SAAS,GAiCjD;kBAjCoB,QAAQ","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameDataManager from \"../../Data/GameDataManager\";\nimport AttackComponent from \"../Components/AttackComponent\";\nimport BaseComponent from \"../Components/BaseComponent\";\nimport RoleComponent from \"../Components/RoleComponent\";\nimport TransformComponent from \"../Components/TransformComponent\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class AISystem extends cc.Component {\n\n    private static _instance:AISystem=null\n    onLoad () {\n        if(null===AISystem._instance){\n            AISystem._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    public static getInstance():AISystem{\n        return AISystem._instance;\n    }\n\n    onUpdate(dt:number,towerTransformComponent:TransformComponent,towerRoleComponent:RoleComponent,towerAttackComponent:AttackComponent,\n        towerBaseComponent,enemyTransformComponent:TransformComponent,enemyBaseComponent:BaseComponent){\n\n        var src = towerBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0,0))\n        var search_R = GameDataManager.getInstance().arrow_tower_params[towerRoleComponent.level - 1].search_R;\n        var dst = enemyBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0,0))\n        var dir = dst.sub(src);\n        if (search_R >= (dir.mag())) {\n            // 攻击\n            towerAttackComponent.activeTime=1.0;\n            towerAttackComponent.enemyID = enemyBaseComponent.entityID;\n            console.log(\"enemyBaseComponent.entityID=\",enemyBaseComponent.entityID)\n            return true\n        }\n        return false\n    }\n}\n"]}