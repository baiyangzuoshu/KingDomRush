{"version":3,"sources":["assets\\Scripts\\ECS\\Systems\\AISystem.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,4EAA4E;AAC5E,mBAAmB;AACnB,sFAAsF;AACtF,8BAA8B;AAC9B,sFAAsF;;;;;;;;;;;;;;;;;;;;;AAEtF,8DAAyD;AACzD,mCAAqD;AAO/C,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAsC,4BAAY;IAAlD;;IA6CA,CAAC;iBA7CoB,QAAQ;IAGzB,yBAAM,GAAN;QACI,IAAG,IAAI,KAAG,UAAQ,CAAC,SAAS,EAAC;YACzB,UAAQ,CAAC,SAAS,GAAC,IAAI,CAAA;SAC1B;aACG;YACA,IAAI,CAAC,OAAO,EAAE,CAAA;YACd,OAAM;SACT;IACL,CAAC;IAEa,oBAAW,GAAzB;QACI,OAAO,UAAQ,CAAC,SAAS,CAAC;IAC9B,CAAC;IAED,2BAAQ,GAAR,UAAS,EAAS,EAAC,qBAAsC,EAAC,kBAAgC,EAAC,oBAAoC,EAC3H,kBAAkB,EAAC,uBAA0C,EAAC,kBAAgC;QAE9F,IAAG,kBAAkB,CAAC,IAAI,IAAE,gBAAS,CAAC,QAAQ,EAAC;YAC3C,oBAAoB,CAAC,UAAU,GAAC,GAAG,CAAC;YACpC,qBAAqB,CAAC,KAAK,GAAC,mBAAY,CAAC,KAAK,CAAC;YAC/C,IAAI,CAAC,GAAG,EAAE,CAAC;YACX,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC;YACpC,IAAI,SAAS,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC7G,qBAAqB,CAAC,MAAM,GAAC,SAAS,CAAC;SAC1C;aACG;YACA,IAAI,GAAG,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAA;YACzE,IAAI,QAAQ,GAAG,yBAAe,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC;YACvG,IAAI,GAAG,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAA;YACzE,IAAI,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACvB,IAAI,QAAQ,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,EAAE;gBACzB,KAAK;gBACL,oBAAoB,CAAC,UAAU,GAAC,GAAG,CAAC;gBACpC,qBAAqB,CAAC,EAAE,GAAC,kBAAkB,CAAC,QAAQ,CAAC;gBACrD,qBAAqB,CAAC,MAAM,GAAC,GAAG,CAAC;gBACjC,qBAAqB,CAAC,KAAK,GAAC,mBAAY,CAAC,KAAK,CAAC;gBAC/C,OAAO,IAAI,CAAA;aACd;SACJ;QAED,OAAO,KAAK,CAAA;IAChB,CAAC;;IA1Cc,kBAAS,GAAU,IAAI,CAAA;IAFrB,QAAQ;QAD5B,OAAO;OACa,QAAQ,CA6C5B;IAAD,eAAC;CA7CD,AA6CC,CA7CqC,EAAE,CAAC,SAAS,GA6CjD;kBA7CoB,QAAQ","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameDataManager from \"../../Data/GameDataManager\";\nimport { AnimateState, TowerType } from \"../../Enum\";\nimport AnimateComponent from \"../Components/AnimateComponent\";\nimport AttackComponent from \"../Components/AttackComponent\";\nimport BaseComponent from \"../Components/BaseComponent\";\nimport RoleComponent from \"../Components/RoleComponent\";\nimport TransformComponent from \"../Components/TransformComponent\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class AISystem extends cc.Component {\n\n    private static _instance:AISystem=null\n    onLoad () {\n        if(null===AISystem._instance){\n            AISystem._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    public static getInstance():AISystem{\n        return AISystem._instance;\n    }\n\n    onUpdate(dt:number,towerAnimateComponent:AnimateComponent,towerRoleComponent:RoleComponent,towerAttackComponent:AttackComponent,\n        towerBaseComponent,enemyTransformComponent:TransformComponent,enemyBaseComponent:BaseComponent){\n        \n        if(towerRoleComponent.type==TowerType.Infantry){\n            towerAttackComponent.activeTime=4.0;\n            towerAnimateComponent.state=AnimateState.Start;\n            var R = 60;\n            var r = Math.random() * 2 * Math.PI;\n            var w_dst_pos = towerBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(R * Math.cos(r), R * Math.sin(r)));\n            towerAnimateComponent.dstPos=w_dst_pos;\n        }\n        else{\n            var src = towerBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0,0))\n            var search_R = GameDataManager.getInstance().arrow_tower_params[towerRoleComponent.level - 1].search_R;\n            var dst = enemyBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0,0))\n            var dir = dst.sub(src);\n            if (search_R >= (dir.mag())) {\n                // 攻击\n                towerAttackComponent.activeTime=1.0;\n                towerAnimateComponent.id=enemyBaseComponent.entityID;\n                towerAnimateComponent.dstPos=dst;\n                towerAnimateComponent.state=AnimateState.Start;\n                return true\n            }\n        }\n        \n        return false\n    }\n}\n"]}