{"version":3,"sources":["assets\\Scripts\\ECS\\ECSUtil.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { EventManager } from \"../../FrameWork/manager/EventManager\";\nimport GameDataManager from \"../Data/GameDataManager\";\nimport { RoleState } from \"../Enum\";\nimport { GameUI } from \"../EventName\";\nimport BaseComponent from \"./Components/BaseComponent\";\nimport RoleComponent from \"./Components/RoleComponent\";\nimport UnitComponent from \"./Components/UnitComponent\";\nimport ECSManager from \"./ECSManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ECSUtil extends cc.Component {\n    private static _instance:ECSUtil=null\n    onLoad () {\n        if(null===ECSUtil._instance){\n            ECSUtil._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    public static getInstance():ECSUtil{\n        return ECSUtil._instance\n    }\n\n    public on_arrowBullet_shoot(attack_value:number,enemyUnitComponent:UnitComponent,enemyBaseComponent:BaseComponent,enemyRoleComponent:RoleComponent){\n        enemyUnitComponent.health -= attack_value;\n        if (enemyUnitComponent.health <= 0) {\n            enemyUnitComponent.health = 0;\n            enemyRoleComponent.state=RoleState.Dead;\n            // 加金币\n            GameDataManager.getInstance().add_chip(enemyUnitComponent.bonues_chip);\n            EventManager.getInstance().emit(GameUI.show_game_uchip);\n            // end \n        }\n        \n        var per = enemyUnitComponent.health / enemyUnitComponent.maxHp;\n        enemyBaseComponent.gameObject.getChildByName(\"blood_bar\").getComponent(cc.ProgressBar).progress = per;\n    }\n    // 炸弹是砸伤一片\n    public on_bullet_bomb(bomb_pos,bomb_R,attack_value) {\n        let len=ECSManager.getInstance().getEnemyTotal();\n        for(var i = 0; i < len; i ++) {\n            let enemy= ECSManager.getInstance().getEnemyEntityByIndex(i);\n            if(enemy&&enemy.roleComponent.state==RoleState.Active){\n                var pos = enemy.baseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0,0));\n                var dir = pos.sub(bomb_pos);\n                if ((dir.mag()) <= bomb_R) {\n                    this.on_arrowBullet_shoot(attack_value,enemy.unitComponent,enemy.baseComponent,enemy.roleComponent);\n                }\n            }\n        }\n    }\n\n    public zorderSortNode(node:cc.Node) {\n        var child = node.children;\n        child.sort(function(lhs, rhs) {\n            if (lhs.y > rhs.y) {\n                return -1;\n            }\n            else if(lhs.y < rhs.y) {\n                return 1;\n            }\n            \n            return 0;\n        });\n        \n        // y大的就会排在前面, y小的就会排在后面\n        for(var i = 0; i < child.length; i ++) {\n            child[i].zIndex = (1000 + i);\n        }\n        // end \n    }\n}\n"]}