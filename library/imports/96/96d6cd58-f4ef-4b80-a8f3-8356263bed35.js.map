{"version":3,"sources":["assets\\Scripts\\Tools\\UpgradeConfig.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameDataManager from \"../Data/GameDataManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class UpgradeConfig extends cc.Component {\n    outside:boolean = false;\n    last_str_lable:cc.Label = null;\n    config_items = []; // 技能0， 5个，技能1 5个，[[item1, item2, item3, item4, item5], [], [], [], [], []]\n\n    // 0 表示置灰, 1，表示可以点击, 2 表示已经升级了，不能点击，但是不能置灰,隐藏掉金币数目\n    _set_button_state(item, state) {\n        var bt = item.getComponent(cc.Button);\n        var bt1 = item.getChildByName(\"star_bg\").getComponent(cc.Button);\n        var bt2 = item.getChildByName(\"star_str\").getComponent(cc.Button);\n        if (state === 0) { // 置灰\n            bt.interactable = false;\n            bt.enableAutoGrayEffect = true;\n            \n            bt1.interactable = false;\n            bt1.enableAutoGrayEffect = true;\n            \n            bt2.interactable = false;\n            bt2.enableAutoGrayEffect = true;\n            \n            item.getChildByName(\"star_bg\").active = true;\n            item.getChildByName(\"star_str\").active = true;\n        }\n        else if(state === 1) {\n            bt.interactable = true;\n            \n            bt1.interactable = false;\n            bt1.enableAutoGrayEffect = false;\n            \n            bt2.interactable = false;\n            bt2.enableAutoGrayEffect = false;\n            \n            item.getChildByName(\"star_bg\").active = true;\n            item.getChildByName(\"star_str\").active = true;\n        }\n        else if(state === 2) {\n            bt.interactable = false;\n            bt.enableAutoGrayEffect = false;\n            \n            item.getChildByName(\"star_bg\").active = false;\n            item.getChildByName(\"star_str\").active = false;\n        }\n    } \n    \n    // use this for initialization\n    onLoad () {\n        this.outside = false;\n        var anim_root = this.node.getChildByName(\"anim_root\");\n        this.last_str_lable = anim_root.getChildByName(\"last_star\").getComponent(cc.Label);\n        \n        this.config_items = []; // 技能0， 5个，技能1 5个，[[item1, item2, item3, item4, item5], [], [], [], [], []]\n        for(var col = 0; col < 6; col ++) {\n            var line_items = [];\n            // 找到每一列的每一个item,加入数组\n            var node = anim_root.getChildByName(\"skill\" + (col + 1));\n            for(var line = 0; line < 5; line ++) {\n                var item = node.getChildByName(\"\" + (line + 1));\n                line_items.push(item);\n                var button = item.addComponent(cc.Button);\n                \n                var eventHandler = new cc.Component.EventHandler();\n                eventHandler.target = this.node;\n                eventHandler.component = \"UpgradeConfig\";\n                eventHandler.handler = \"on_config_item_click\";\n                eventHandler.customEventData = ((col + 1) + \"\" + (line + 1));\n                \n                button.clickEvents = [eventHandler];\n                \n                item.getChildByName(\"star_bg\").addComponent(cc.Button);\n                item.getChildByName(\"star_str\").addComponent(cc.Button);\n                \n                this._set_button_state(item, 1);\n            }\n            // end \n            this.config_items.push(line_items);\n        }\n        \n        // this._show_skill_upgrade_config([0, 1, 2, 3, 4, 5]);\n        var udata = GameDataManager.getInstance().get_cur_user();\n        //console.log(udata.skill_level_info, udata.star_num)\n        this._show_skill_upgrade_config(udata.skill_level_info, udata.star_num);\n    }\n    \n    // [skill_level, skill2_level2, skill3_leve3, skill_4_leve3, skill5_level3, ]\n    // [0, 1, 2, 3, 4, 5]\n    _show_skill_upgrade_config(level_config_data, star_num) {\n        // 根据我们用户当前的升级配置表，我们要计算出来，当前用户还剩下多少颗星星\n        var last_star = star_num;\n        var i, j, level;\n        for(i = 0; i < level_config_data.length; i ++) {\n            level = level_config_data[i];\n            console.log(GameDataManager.getInstance().tower_skills_upgrade_config)\n            for(j = 0; j <= level; j ++) {\n                let consume = GameDataManager.getInstance().tower_skills_upgrade_config[i][j];\n                last_star -= consume;\n            }\n        }\n        // end \n        \n        for(i = 0; i < level_config_data.length; i ++) {\n            // skill i 的级别\n            level = level_config_data[i];\n            var line_items = this.config_items[i]; // 这个技能的所有级别的按钮集合\n            console.log(i,line_items)\n            j = 0;\n            for(j = 0; j < level; j ++) { // 表示你已经升级了\n                this._set_button_state(line_items[j], 2);\n            }\n            // 把当前下一个升级的级别这里设置可以升级的状态;\n            // 剩余的进步数目也要足够\n            if (j < 5 && last_star >= GameDataManager.getInstance().tower_skills_upgrade_config[i][level + 1]) {\n                this._set_button_state(line_items[j], 1);\n                j ++;\n            }\n            // 后面都是不能点击的，状态要置灰\n            for(; j < 5; j ++) {\n                this._set_button_state(line_items[j], 0);\n            }\n            // end \n        }\n        \n        // 更新一下剩余的星星的数目;\n        this.last_str_lable.string = \"\" + last_star;\n        // end \n    }\n    \n    // 我们的配置升级点击\n    // 11, skill, 1级别, 21 skill2, 1级别\n    on_config_item_click(t, skill_level) {\n        if (this.outside === true) {\n            return;\n        }\n        \n        skill_level = parseInt(skill_level);\n        console.log(skill_level);\n        \n        var index = Math.floor(skill_level / 10); // 获取了这个的10位\n        var level = skill_level - index * 10;\n        index --;\n        \n        var udata = GameDataManager.getInstance().get_cur_user();\n        udata.skill_level_info[index] = level;\n        \n        this._show_skill_upgrade_config(udata.skill_level_info, udata.star_num);\n    }\n    // end \n    \n    // 完成按钮点击\n    on_done_click() {\n        if (this.outside === true) {\n            return;\n        }\n        this.outside = true;\n        // 保存用户数据\n        GameDataManager.getInstance().sync_user_data();\n        // end \n        \n        // 隐藏掉这个界面\n        var anim_com = this.node.getComponent(cc.Animation);\n        anim_com.play(\"reserve_road_skill_upgrade_config\");\n        this.scheduleOnce(function() {\n            this.node.active = false;\n            this.outside = false;\n        }.bind(this), anim_com.currentClip.duration);\n        // end \n    }\n    // end \n    \n    // 重置按钮点击\n    on_reset_click() {\n        if (this.outside === true) {\n            return;\n        }\n        \n        var udata = GameDataManager.getInstance().get_cur_user();\n        udata.skill_level_info = [0, 0, 0, 0, 0, 0];\n        \n        this._show_skill_upgrade_config(udata.skill_level_info, udata.star_num);\n    }\n}\n"]}