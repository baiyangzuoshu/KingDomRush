{"version":3,"sources":["assets\\Scripts\\UI\\RoadMapUIControl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { EventManager } from \"../../FrameWork/manager/EventManager\";\nimport { UIManagerPro } from \"../../FrameWork/manager/UIManagerPro\";\nimport { UIControl } from \"../../FrameWork/ui/UIControl\";\nimport GameDataManager from \"../Data/GameDataManager\";\nimport { ViewUI } from \"../Enum\";\nimport { HomeUI } from \"../EventName\";\nimport LevelEntryInfo from \"../Tools/LevelEntryInfo\";\nimport LoadingDoor from \"../Tools/LoadingDoor\";\nimport UpgradeConfig from \"../Tools/UpgradeConfig\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class RoadMapUIControl extends UIControl {\n    door:LoadingDoor=null;\n    outside:boolean=false;\n    new_level_entry:cc.Node=null;\n    passed_entry:cc.Node[]=[];\n    level_num:number=19;\n    newest_level:number=-1;\n    upgrade_config:cc.Node=null;\n    go_back:boolean=false;\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        super.onLoad();\n        // 播放背景音乐\n        //sound_manager.play_music(\"resources/sounds/music/roadmap_scene_bg.mp3\", true);\n        // end\n\n        this.door = this.getChildByUrl(\"loading_door\").addComponent(LoadingDoor);\n        this.door.setData(0, 0.4);\n\n        this.outside = false;\n\n        this.new_level_entry = this.getChildByUrl(\"anchor-center/new_level_entry\");\n        this.new_level_entry.active = false;\n\n        this.passed_entry = [];\n        var map_entry_root = this.getChildByUrl(\"anchor-center/map_entry_root\");\n        for(var i = 0; i < this.level_num; i ++) {\n            var name = \"level\" + (i + 1);\n            let levelNode:cc.Node=map_entry_root.getChildByName(name);\n            let ts=levelNode.addComponent(LevelEntryInfo);\n            ts.setData(1);\n\n            this.passed_entry.push(levelNode);  \n            var bt = this.passed_entry[i].getComponent(cc.Button);\n            var click_event = new cc.Component.EventHandler();\n            click_event.target = this.node;\n            click_event.component = \"RoadMapUIControl\";\n            click_event.handler = \"on_passed_entry_click\";\n            click_event.customEventData = \"\" + i;\n            bt.clickEvents = [click_event];\n        }\n\n        this.newest_level = -1;\n\n        // 装备升级\n        this.upgrade_config = this.getChildByUrl(\"anchor-center/upgrade_config\");\n        this.upgrade_config.addComponent(UpgradeConfig);\n        this.upgrade_config.active = false;\n        // end \n\n        this.registerBtnClickEvent();\n    }\n\n    registerBtnClickEvent(){\n        this.buttonAddClickEvent(\"anchor-bottom/bottom_button_root/back_bt\",this.goto_home,this);\n        this.buttonAddClickEvent(\"anchor-bottom/bottom_button_root/upgrade\",this.on_skill_upgrade_config_click,this);\n        this.buttonAddClickEvent(\"anchor-center/upgrade_config/anim_root/reset\",this.on_reset_upgrade_config_click,this);\n        this.buttonAddClickEvent(\"anchor-center/upgrade_config/anim_root/done\",this.on_done_upgrade_config_click,this);\n        this.buttonAddClickEvent(\"anchor-center/new_level_entry\",this.on_new_entry_click,this);\n    }\n\n    on_done_upgrade_config_click(){\n        this.upgrade_config.active = false;\n        this.upgrade_config.getComponent(cc.Animation).play(\"reserve_road_skill_upgrade_config\");\n    }\n\n    on_reset_upgrade_config_click(){\n\n    }\n\n    _show_user_star_info() {\n        var label = this.getChildByUrl(\"anchor-rt/game_star_info/star_num\").getComponent(cc.Label);\n        var cur_user = GameDataManager.getInstance().get_cur_user();\n        label.string = cur_user.star_num + \" / \" + cur_user.star_total;\n    } \n\n    _show_game_level_info() {\n        // 获取当前用户的用户信息，来获得它挑战的关卡的成绩;\n        var cur_user = GameDataManager.getInstance().get_cur_user();\n        var level_info = cur_user.level_info;\n        // var level_info = [1, 3, 1, 2, 2, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        // end \n        var i = 0;\n        var len = (level_info.length < this.level_num) ? level_info.length : this.level_num;\n        // 显示通过了的关的关卡的成绩\n        for(i = 0; i < len; i ++) {\n            if (level_info[i] === 0) { // 遇到了没有打通的关卡\n                break;\n            }\n            this.passed_entry[i].active = true;\n            this.passed_entry[i].getComponent(LevelEntryInfo).show_level_star_info(level_info[i]);\n        }\n\n        // 第一个为星星为0的关卡，玩家可以来挑战\n        this.newest_level = i;\n        if (this.newest_level >= this.level_num) { // 全部挑战成功\n            this.new_level_entry.active = false;\n            this.newest_level = this.level_num - 1;\n        }\n        else {\n            this.new_level_entry.active = true;\n            // 把这个棋子插在对应的位置\n            this.new_level_entry.x = this.passed_entry[this.newest_level].x;\n            this.new_level_entry.y = this.passed_entry[this.newest_level].y;\n            // end \n        }\n        // end \n        console.log(\"newest_level = \" + this.newest_level);\n        for(; i < this.level_num; i ++) {\n            this.passed_entry[i].active = false;\n        }\n    }\n    // 打开这个门;\n    start() {\n        this._show_game_level_info();\n        this._show_user_star_info();\n\n\n        this.door.open_the_door(null);\n    }\n\n    // 跳转到home场景;\n    goto_home() {\n        if (this.go_back === true) { // 使用变量挡住在播放动画时候的 按钮多次点击。\n            return;\n        }\n        // 播放按钮的音效\n        //sound_manager.play_effect(\"resources/sounds/click.wav\");\n\n        this.go_back = true;\n        this.door.close_the_door(function(){\n            UIManagerPro.getInstance().closePrefab(ViewUI.RoadMapUI);\n            EventManager.getInstance().emit(HomeUI.open_the_door);    \n        }.bind(this));\n    }\n    // end \n\n    _goto_game_scene(level) {\n        console.log(\"goto game scene at level:\", level);\n        // 保存当前可以游戏的关卡,保存到GameDataManager.getInstance()里面，游戏场景就可以直接访问的到；\n        GameDataManager.getInstance().set_cur_level(level);\n        // end \n\n        console.log(\"enter game_scene at level:\", GameDataManager.getInstance().get_cur_level());\n        // 调转到游戏场景;\n        this.door.close_the_door(function(){\n            UIManagerPro.getInstance().showPrefab(\"GameUI\");    \n        }.bind(this));\n        // end \n    }\n\n    // 新的没有挑战过的关卡点击\n    on_new_entry_click() {\n        if (this.outside === true) {\n            return;\n        }\n        this.outside = true;\n        this._goto_game_scene(this.newest_level)\n    }\n    // end \n\n    // 已经挑战的关卡点击进入\n    on_passed_entry_click(t,data) {\n        let level=parseInt(data)\n        if (this.outside === true) {\n            return;\n        }\n        this.outside = true;\n        this._goto_game_scene(level);\n    }\n    // end \n\n    // 用户技能配置设置\n    on_skill_upgrade_config_click() {\n        this.upgrade_config.active = true;\n        this.upgrade_config.getComponent(cc.Animation).play(\"road_skill_upgrade_config\");\n    }\n}\n"]}