{"version":3,"sources":["assets\\Scripts\\ECS\\ECSFactory.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { ResManagerPro } from \"../../FrameWork/manager/ResManagerPro\";\nimport { Enemy, TowerType } from \"../Enum\";\nimport ArrowEntity from \"./Entities/ArrowEntity\";\nimport CannonEntity from \"./Entities/CannonEntity\";\nimport EnemyEntity from \"./Entities/EnemyEntity\";\nimport InfantryEntity from \"./Entities/InfantryEntity\";\nimport TowerEntity from \"./Entities/TowerEntity\";\nimport WarlockEntity from \"./Entities/WarlockEntity\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ECSFactory extends cc.Component {\n    private static _instance:ECSFactory=null\n    onLoad () {\n        if(null===ECSFactory._instance){\n            ECSFactory._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n\n        let canvas=cc.find(\"Canvas\");\n        this.towerNode=canvas.getChildByName(\"towerNode\");\n        this.enemyNode=canvas.getChildByName(\"enemyNode\");\n    }\n\n    public static getInstance():ECSFactory{\n        return ECSFactory._instance\n    }\n\n    private static entityID:number=0;\n    private towerNode:cc.Node=null;\n    private enemyNode:cc.Node=null;\n    async createEnemyEntity(enemy_type:number,road_data:any,actor_params:any):Promise<EnemyEntity>{\n        //console.log(road_data);\n        let entity:EnemyEntity=new EnemyEntity();\n\n        let enemy_prefab:cc.Prefab=null;\n        if(Enemy.Bear==enemy_type){\n            enemy_prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Enemy/ememy_bear\",cc.Prefab) as cc.Prefab;\n        }\n        else if(Enemy.Forkman==enemy_type){\n            enemy_prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Enemy/ememy_forkman\",cc.Prefab) as cc.Prefab;\n        }\n        else if(Enemy.Small1==enemy_type){\n            enemy_prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Enemy/ememy_small1\",cc.Prefab) as cc.Prefab;\n        }\n        else if(Enemy.Gorilla==enemy_type){\n            enemy_prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Enemy/ememy_gorilla\",cc.Prefab) as cc.Prefab;\n        }\n        else if(Enemy.Small2==enemy_type){\n            enemy_prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Enemy/ememy_small2\",cc.Prefab) as cc.Prefab;\n        }\n        else if(Enemy.Carry==enemy_type){\n            enemy_prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Enemy/ememy_carry\",cc.Prefab) as cc.Prefab;\n        }\n        else if(Enemy.Small3==enemy_type){\n            enemy_prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Enemy/ememy_small3\",cc.Prefab) as cc.Prefab;\n        }\n        var enemy = cc.instantiate(enemy_prefab);\n        enemy.active = true;\n        this.enemyNode.addChild(enemy);\n        enemy.setPosition(cc.v2(road_data[0].x, road_data[0].y));\n\n        entity.navComponent.path=road_data;\n        entity.navComponent.curTime=0;\n        entity.navComponent.curIndex=0;\n        entity.navComponent.speed=actor_params.speed;\n\n        entity.transformComponent.x=road_data[0].x;\n        entity.transformComponent.y=road_data[0].y;\n\n        entity.baseComponent.entityID=ECSFactory.entityID++;\n        entity.baseComponent.gameObject=enemy;\n\n        entity.unitComponent.speed=actor_params.speed;\n        entity.unitComponent.attack=actor_params.attack;\n        entity.unitComponent.health=actor_params.health;\n        entity.unitComponent.player_hurt=actor_params.player_hurt;\n        entity.unitComponent.bonues_chip=actor_params.bonues_chip;\n\n        return entity;\n    }\n\n    async createArrowEntity(world_pos:cc.Vec2):Promise<TowerEntity>{\n        let entity:ArrowEntity=new ArrowEntity();\n        \n        let prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Game/arrow_tower\",cc.Prefab) as cc.Prefab;\n        \n        let builded_tower = cc.instantiate(prefab) as cc.Node;\n        this.towerNode.addChild(builded_tower);\n        \n        var center_pos = this.towerNode.convertToNodeSpaceAR(world_pos);\n        builded_tower.setPosition(center_pos);\n        builded_tower.active = true;\n\n        entity.baseComponent.entityID=ECSFactory.entityID++;\n        entity.baseComponent.gameObject=builded_tower;\n\n        entity.transformComponent.x=center_pos.x;\n        entity.transformComponent.y=center_pos.y;\n\n        entity.roleComponent.type=TowerType.Arrow;\n\n        return entity;\n    }\n\n    async createWarlockEntity(world_pos:cc.Vec2):Promise<TowerEntity>{\n        let entity:WarlockEntity=new WarlockEntity();\n        \n        let prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Game/warlock_tower\",cc.Prefab) as cc.Prefab;\n        \n        let builded_tower = cc.instantiate(prefab) as cc.Node;\n        this.towerNode.addChild(builded_tower);\n        \n        var center_pos = this.towerNode.convertToNodeSpaceAR(world_pos);\n        builded_tower.setPosition(center_pos);\n        builded_tower.active = true;\n\n        entity.baseComponent.entityID=ECSFactory.entityID++;\n        entity.baseComponent.gameObject=builded_tower;\n\n        entity.transformComponent.x=center_pos.x;\n        entity.transformComponent.y=center_pos.y;\n\n        entity.roleComponent.type=TowerType.Warlock;\n\n        return entity;\n    }\n\n    async createCannonEntity(world_pos:cc.Vec2):Promise<TowerEntity>{\n        let entity:CannonEntity=new CannonEntity();\n        \n        let prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Game/cannon_tower\",cc.Prefab) as cc.Prefab;\n        \n        let builded_tower = cc.instantiate(prefab) as cc.Node;\n        this.towerNode.addChild(builded_tower);\n        \n        var center_pos = this.towerNode.convertToNodeSpaceAR(world_pos);\n        builded_tower.setPosition(center_pos);\n        builded_tower.active = true;\n\n        entity.baseComponent.entityID=ECSFactory.entityID++;\n        entity.baseComponent.gameObject=builded_tower;\n\n        entity.transformComponent.x=center_pos.x;\n        entity.transformComponent.y=center_pos.y;\n\n        entity.roleComponent.type=TowerType.Cannon;\n\n        return entity;\n    }\n\n    async createInfantryEntity(world_pos:cc.Vec2):Promise<TowerEntity>{\n        let entity:InfantryEntity=new InfantryEntity();\n        \n        let prefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"Game/infantry_tower\",cc.Prefab) as cc.Prefab;\n        \n        let builded_tower = cc.instantiate(prefab) as cc.Node;\n        this.towerNode.addChild(builded_tower);\n        \n        var center_pos = this.towerNode.convertToNodeSpaceAR(world_pos);\n        builded_tower.setPosition(center_pos);\n        builded_tower.active = true;\n\n        entity.baseComponent.entityID=ECSFactory.entityID++;\n        entity.baseComponent.gameObject=builded_tower;\n\n        entity.transformComponent.x=center_pos.x;\n        entity.transformComponent.y=center_pos.y;\n\n        entity.roleComponent.type=TowerType.Infantry;\n\n        return entity;\n    }\n}\n"]}