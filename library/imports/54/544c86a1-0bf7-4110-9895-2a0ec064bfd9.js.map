{"version":3,"sources":["assets\\Scripts\\ECS\\Systems\\AttackSystem.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,4EAA4E;AAC5E,mBAAmB;AACnB,sFAAsF;AACtF,8BAA8B;AAC9B,sFAAsF;;;;;;;;;;;;;;;;;;;;;AAOtF,4CAAuC;AAGjC,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAA0C,gCAAY;IAAtD;;IA2DA,CAAC;qBA3DoB,YAAY;IAE7B,6BAAM,GAAN;QACI,IAAG,IAAI,KAAG,cAAY,CAAC,SAAS,EAAC;YAC7B,cAAY,CAAC,SAAS,GAAC,IAAI,CAAA;SAC9B;aACG;YACA,IAAI,CAAC,OAAO,EAAE,CAAA;YACd,OAAM;SACT;IACL,CAAC;IAEa,wBAAW,GAAzB;QACI,OAAO,cAAY,CAAC,SAAS,CAAC;IAClC,CAAC;IAED,+BAAQ,GAAR,UAAS,EAAS,EAAC,oBAAoC,EAAC,kBAAgC,EACpF,kBAAgC;QAChC,IAAI,WAAW,GAAa,oBAAU,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QACtG,IAAG,IAAI,IAAE,WAAW,EAAC;YACjB,OAAM;SACT;QAED,+CAA+C;QAC/C,iBAAiB;QACjB,+CAA+C;QAC/C,IAAI;QAEJ,sDAAsD;QACtD,0CAA0C;QAC1C,kCAAkC;QAClC,mBAAmB;QACnB,2BAA2B;QAC3B,sFAAsF;QACtF,4CAA4C;QAC5C,mCAAmC;QACnC,uCAAuC;QACvC,qBAAqB;QACrB,IAAI;QACJ,iBAAiB;QACjB,wFAAwF;QACxF,4CAA4C;QAC5C,mCAAmC;QACnC,uCAAuC;QACvC,qBAAqB;QACrB,IAAI;QACJ,OAAO;QAEP,IAAI,UAAU,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;QACnF,IAAI,SAAS,GAAC,WAAW,CAAC,aAAa,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACzF,qBAAqB;QACrB,yDAAyD;QACzD,yCAAyC;QACzC,4BAA4B;QAC5B,UAAU;QACV,2FAA2F;QAC3F,oBAAU,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,IAAI,EAAC,kBAAkB,CAAC,KAAK,EAAC,UAAU,EAAC,SAAS,EAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QAChJ,oBAAoB,CAAC,OAAO,GAAC,CAAC,CAAC;IACnC,CAAC;;IAzDc,sBAAS,GAAc,IAAI,CAAA;IADzB,YAAY;QADhC,OAAO;OACa,YAAY,CA2DhC;IAAD,mBAAC;CA3DD,AA2DC,CA3DyC,EAAE,CAAC,SAAS,GA2DrD;kBA3DoB,YAAY","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameDataManager from \"../../Data/GameDataManager\";\nimport AttackComponent from \"../Components/AttackComponent\";\nimport BaseComponent from \"../Components/BaseComponent\";\nimport RoleComponent from \"../Components/RoleComponent\";\nimport TransformComponent from \"../Components/TransformComponent\";\nimport ECSManager from \"../ECSManager\";\nimport EnemyEntity from \"../Entities/EnemyEntity\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class AttackSystem extends cc.Component {\n    private static _instance:AttackSystem=null\n    onLoad () {\n        if(null===AttackSystem._instance){\n            AttackSystem._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    public static getInstance():AttackSystem{\n        return AttackSystem._instance;\n    }\n\n    onUpdate(dt:number,towerAttackComponent:AttackComponent,towerBaseComponent:BaseComponent,\n        towerRoleComponent:RoleComponent){\n        let enemyEntity:EnemyEntity=ECSManager.getInstance().getEnemyEntityByID(towerAttackComponent.enemyID);\n        if(null==enemyEntity){\n            return\n        }\n\n        // var f_anim = man.getComponent(\"frame_anim\");\n        // if (!f_anim) {\n        //     f_anim = man.addComponent(\"frame_anim\");\n        // }\n        \n        // var w_pos = man.convertToWorldSpaceAR(cc.v2(0, 0));\n        // // var dir = cc.pSub(w_dst_pos, w_pos);\n        // var dir = w_dst_pos.sub(w_pos);\n        // // 判断当前是要播放上，还是下\n        // if (dir.y > 0) { // 上的动画\n        //     f_anim.sprite_frames = this.level_tower_skin_res[this.tower_level - 1].up_anim;\n        //     f_anim.duration = this.anim_duration;\n        //     f_anim.play_once(function(){\n        //         this._set_anim_idle(man, 0);\n        //     }.bind(this));\n        // }\n        // else { // 下的动画\n        //     f_anim.sprite_frames = this.level_tower_skin_res[this.tower_level - 1].down_anim;\n        //     f_anim.duration = this.anim_duration;\n        //     f_anim.play_once(function(){\n        //         this._set_anim_idle(man, 1);\n        //     }.bind(this));\n        // }\n        // end \n        \n        var center_pos = towerBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0, 29));\n        var enemy_pos=enemyEntity.baseComponent.gameObject.convertToWorldSpaceAR(cc.v2(29, -29));\n        // 生成我们的子弹对象，让它发射到目标点\n        // var bullet = cc.instantiate(this.arrow_bullet_prefab);\n        // this.bullet_root.addChild(bullet);    \n        // bullet.active = true;    \n        // // end \n        // bullet.getComponent(\"arrow_bullet\").shoot_at(this.tower_level, w_pos, w_dst_pos, enemy);\n        ECSManager.getInstance().createBulletEntity(towerRoleComponent.type,towerRoleComponent.level,center_pos,enemy_pos,towerAttackComponent.enemyID);\n        towerAttackComponent.enemyID=0;\n    } \n}\n"]}