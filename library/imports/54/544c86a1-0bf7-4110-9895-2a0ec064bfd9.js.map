{"version":3,"sources":["assets\\Scripts\\ECS\\Systems\\AttackSystem.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,4EAA4E;AAC5E,mBAAmB;AACnB,sFAAsF;AACtF,8BAA8B;AAC9B,sFAAsF;;;;;;;;;;;;;;;;;;;;;AAQtF,4CAAuC;AAGjC,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAA0C,gCAAY;IAAtD;;IAyCA,CAAC;qBAzCoB,YAAY;IAE7B,6BAAM,GAAN;QACI,IAAG,IAAI,KAAG,cAAY,CAAC,SAAS,EAAC;YAC7B,cAAY,CAAC,SAAS,GAAC,IAAI,CAAA;SAC9B;aACG;YACA,IAAI,CAAC,OAAO,EAAE,CAAA;YACd,OAAM;SACT;IACL,CAAC;IAEa,wBAAW,GAAzB;QACI,OAAO,cAAY,CAAC,SAAS,CAAC;IAClC,CAAC;IAED,+BAAQ,GAAR,UAAS,EAAS,EAAC,oBAAoC,EAAC,kBAAgC,EACpF,kBAAgC;QAEhC,IAAI,WAAW,GAAa,oBAAU,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QACtG,IAAG,IAAI,IAAE,WAAW,EAAC;YACjB,OAAM;SACT;QAED,IAAI,UAAU,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAClF,IAAI,SAAS,GAAS,WAAW,CAAC,aAAa,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAE9F,oBAAU,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,IAAI,EAAC,kBAAkB,CAAC,KAAK,EAAC,UAAU,EAAC,SAAS,EAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QAChJ,oBAAoB,CAAC,OAAO,GAAC,CAAC,CAAC;IACnC,CAAC;IAED,4CAAqB,GAArB,UAAsB,EAAE,EAAC,oBAAoC,EAAC,kBAAgC,EAC1F,kBAAgC;QAChC,IAAI,UAAU,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACpF,IAAI,CAAC,GAAG,EAAE,CAAC;QACX,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC;QACpC,IAAI,SAAS,GAAG,kBAAkB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAE7G,oBAAU,CAAC,WAAW,EAAE,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,IAAI,EAAC,kBAAkB,CAAC,KAAK,EAAC,UAAU,EAAC,SAAS,EAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QAChJ,oBAAoB,CAAC,OAAO,GAAC,CAAC,CAAC;IACnC,CAAC;;IAvCc,sBAAS,GAAc,IAAI,CAAA;IADzB,YAAY;QADhC,OAAO;OACa,YAAY,CAyChC;IAAD,mBAAC;CAzCD,AAyCC,CAzCyC,EAAE,CAAC,SAAS,GAyCrD;kBAzCoB,YAAY","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameDataManager from \"../../Data/GameDataManager\";\nimport { TowerType } from \"../../Enum\";\nimport AttackComponent from \"../Components/AttackComponent\";\nimport BaseComponent from \"../Components/BaseComponent\";\nimport RoleComponent from \"../Components/RoleComponent\";\nimport TransformComponent from \"../Components/TransformComponent\";\nimport ECSManager from \"../ECSManager\";\nimport EnemyEntity from \"../Entities/EnemyEntity\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class AttackSystem extends cc.Component {\n    private static _instance:AttackSystem=null\n    onLoad () {\n        if(null===AttackSystem._instance){\n            AttackSystem._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    public static getInstance():AttackSystem{\n        return AttackSystem._instance;\n    }\n\n    onUpdate(dt:number,towerAttackComponent:AttackComponent,towerBaseComponent:BaseComponent,\n        towerRoleComponent:RoleComponent){\n        \n        let enemyEntity:EnemyEntity=ECSManager.getInstance().getEnemyEntityByID(towerAttackComponent.enemyID);\n        if(null==enemyEntity){\n            return\n        }\n        \n        var center_pos = towerBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0, 0));\n        var enemy_pos:cc.Vec2=enemyEntity.baseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0, 0));\n        \n        ECSManager.getInstance().createBulletEntity(towerRoleComponent.type,towerRoleComponent.level,center_pos,enemy_pos,towerAttackComponent.enemyID);\n        towerAttackComponent.enemyID=0;\n    }\n    \n    onInfantryActorUpdate(dt,towerAttackComponent:AttackComponent,towerBaseComponent:BaseComponent,\n        towerRoleComponent:RoleComponent){\n        var center_pos = towerBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(0, -15));\n        var R = 60;\n        var r = Math.random() * 2 * Math.PI;\n        var w_dst_pos = towerBaseComponent.gameObject.convertToWorldSpaceAR(cc.v2(R * Math.cos(r), R * Math.sin(r)));\n        \n        ECSManager.getInstance().createBulletEntity(towerRoleComponent.type,towerRoleComponent.level,center_pos,w_dst_pos,towerAttackComponent.enemyID);\n        towerAttackComponent.enemyID=0;\n    }\n}\n"]}