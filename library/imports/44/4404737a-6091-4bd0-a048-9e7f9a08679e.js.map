{"version":3,"sources":["assets\\Scripts\\Game\\TowerBuilder.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { EventManager } from \"../../FrameWork/manager/EventManager\";\nimport { UIControl } from \"../../FrameWork/ui/UIControl\";\nimport GameDataManager from \"../Data/GameDataManager\";\nimport { GameUI } from \"../EventName\";\nimport GuiTowerBuilder from \"./GuiTowerBuilder\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class TowerBuilder extends UIControl {\n    gui_tower_builder:GuiTowerBuilder=null;\n    icon:cc.Node=null;\n    tower_type:number=0;\n    builded_tower:cc.Node=null;\n    is_builded:boolean=false;\n    map_root:cc.Node=null;\n    tower_params:any[]=[];\n    game_scene:any=null;\n    tower_prefabs:cc.Prefab[]=[];\n    tower_offset:Array<cc.Vec2>=[];\n    index:number=0;\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        super.onLoad();\n\n        this.tower_offset.push(cc.v2(-8,-4));\n        this.tower_offset.push(cc.v2(-5,7));\n        this.tower_offset.push(cc.v2(-1,8));\n        this.tower_offset.push(cc.v2(-5,7));\n       \n        \n        this.icon = this.node.getChildByName(\"icon\");\n        \n        this.tower_type = 0;\n        this.builded_tower = null;\n        this.is_builded = false;\n        //this.map_root = cc.find(\"GameUI/map_root\");\n\n        // 四种塔索对应的参数\n        this.tower_params = [null, null, null, null];\n        this.tower_params[0] = GameDataManager.getInstance().arrow_tower_params\n        this.tower_params[1] = GameDataManager.getInstance().warlock_tower_params\n        this.tower_params[2] = GameDataManager.getInstance().cannon_tower_params\n        this.tower_params[3] = GameDataManager.getInstance().infantry_tower_params\n\n        //this.game_scene = cc.find(\"GameUI\").getComponent(\"game_scene\");\n\n        this.buttonAddClickEvent(\"click_mask\", this.on_click_mask,this);\n    }\n\n    setData(index:number){\n        this.index=index;\n    }\n\n    on_click_mask(btn:cc.Button) {\n        console.log(\"on_click_mask\",this.index);\n        this.show_tower_builder();\n    }\n\n    check_uchip_when_build(tower_type, level) {\n        var build_chip = this.tower_params[tower_type - 1][level - 1].build_chip;\n\n        var uchip = GameDataManager.getInstance().get_uchip();\n        if (uchip >= build_chip) {\n            return true;\n        }\n\n        return false;\n    }\n\n    show_tower_builder() {\n        EventManager.getInstance().emit(GameUI.show_tower_builder,{is_builded:this.is_builded,tower_builder:this});\n    }\n    \n    remove_builder_tower() {\n        if (this.is_builded === false) {\n            return;\n        }\n        this.builded_tower.removeFromParent();\n        this.builded_tower = null;\n        this.is_builded = false;\n        this.tower_type = 0;\n        this.icon.active = true;\n    }\n    \n    on_tower_undo_click() {\n        if (this.is_builded === false) {\n            return;\n        }\n        \n        // 回收金币\n        var tower_com = this.get_build_tower_com();\n        var tower_level = tower_com.get_tower_level();\n        var undo_chip = this.tower_params[this.tower_type - 1][tower_level - 1].build_chip;\n        GameDataManager.getInstance().add_chip(undo_chip);\n        this.game_scene.show_game_uchip();\n        // end \n\n        this.builded_tower.removeFromParent();\n        this.builded_tower = null;\n        this.is_builded = false;\n        this.tower_type = 0;\n        this.icon.active = true;\n    }\n    \n    // 1, 弓箭, 2, 法师, 3,炮塔, 4兵塔\n    on_tower_build_click(t, tower_type) {\n        tower_type = parseInt(tower_type);\n        \n        if (tower_type <= 0 || this.tower_type > 4) {\n            return;\n        }\n        \n        if (!this.check_uchip_when_build(tower_type, 1)) {\n            return;\n        }\n        \n        this.tower_type = tower_type;\n        this.icon.active = false;\n        \n        // 造一个塔\n        this.builded_tower = cc.instantiate(this.tower_prefabs[tower_type - 1]);\n        this.map_root.addChild(this.builded_tower);\n        \n        var center_pos = this.node.getPosition();\n        center_pos.x  += this.tower_offset[tower_type - 1].x;\n        center_pos.y  += this.tower_offset[tower_type - 1].y;\n        \n        this.builded_tower.setPosition(center_pos);\n        this.builded_tower.active = true;\n        this.is_builded = true;\n        // end \n        \n        // 消耗你的金币\n        var build_chip = this.tower_params[tower_type - 1][0].build_chip;\n        GameDataManager.getInstance().add_chip(-build_chip);\n        this.game_scene.show_game_uchip();\n        // end \n    }\n    \n    get_build_tower_com() {\n        var tower_com = null;\n        switch(this.tower_type) {\n            case 1: // 弓箭塔\n                tower_com = this.builded_tower.getComponent(\"arrow_tower\");\n            break;\n            case 2: // 法师塔\n                tower_com = this.builded_tower.getComponent(\"warlock_tower\");\n            break;\n            case 3: // 炮塔\n                tower_com = this.builded_tower.getComponent(\"cannon_tower\");\n            break;\n            case 4: // 兵塔\n                tower_com = this.builded_tower.getComponent(\"infantry_tower\");\n            break;\n        }\n\n        return tower_com;\n    }\n\n    on_tower_upgrade_click() {\n\n        if (this.is_builded === false || this.builded_tower === null) {\n            return;\n        }\n        \n        // 检查升级所要的金币\n        var tower_com = this.get_build_tower_com();\n\n        var tower_level = tower_com.get_tower_level();\n        if (tower_level >= 4) {\n            return;\n        }\n\n        var upgrade_chip = this.tower_params[this.tower_type - 1][tower_level].build_chip - \n                           this.tower_params[this.tower_type - 1][tower_level - 1].build_chip;\n        if (upgrade_chip > GameDataManager.getInstance().get_uchip()) {\n            return;\n        }\n\n\n        // end \n        \n\n        if (tower_com) {\n            var tower_level = tower_com.upgrade_tower();\n        }\n\n        // 消耗金币\n        GameDataManager.getInstance().add_chip(-upgrade_chip);\n        this.game_scene.show_game_uchip();\n        // end \n    }\n}\n"]}