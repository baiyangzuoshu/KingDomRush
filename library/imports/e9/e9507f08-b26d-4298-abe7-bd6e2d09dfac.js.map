{"version":3,"sources":["assets\\Scripts\\ECS\\ECSManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { AnimateState, TowerType } from \"../Enum\";\nimport ECSFactory from \"./ECSFactory\";\nimport BulletEntity from \"./Entities/BulletEntity\";\nimport EnemyEntity from \"./Entities/EnemyEntity\";\nimport { InfantryActor } from \"./Entities/InfantryActor\";\nimport TowerEntity from \"./Entities/TowerEntity\";\nimport AISystem from \"./Systems/AISystem\";\nimport AnimateSystem from \"./Systems/AnimateSystem\";\nimport AttackSystem from \"./Systems/AttackSystem\";\nimport NavSystem from \"./Systems/NavSystem\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ECSManager extends cc.Component {\n    private static _instance:ECSManager=null\n    onLoad () {\n        if(null===ECSManager._instance){\n            ECSManager._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    public static getInstance():ECSManager{\n        return ECSManager._instance\n    }\n\n    private towerEntityList:TowerEntity[]=[];\n    private enemyEntityList:EnemyEntity[]=[];\n    private bulletEntityList:BulletEntity[]=[];\n    private actorEntityList:InfantryActor[]=[];\n    //\n    public getEnemyTotal(){\n        return this.enemyEntityList.length;\n    }\n    public getEnemyEntityByIndex(index:number):EnemyEntity{\n        for(let i=0;i<this.enemyEntityList.length;i++){\n            if(i==index){\n                return this.enemyEntityList[i];\n            }\n        }\n        return null;\n    }\n    //\n    async createBulletEntity(tower_type:number,tower_level:number, w_pos:cc.Vec2, w_dst_pos:cc.Vec2, enemyID:number){\n        if(TowerType.Arrow==tower_type){\n            let entity:BulletEntity=await ECSFactory.getInstance().createArrowBulletEntity(tower_type,tower_level, w_pos, w_dst_pos, enemyID);\n            this.bulletEntityList.push(entity);\n        }\n        else if(TowerType.Cannon==tower_type){\n            let entity:BulletEntity=await ECSFactory.getInstance().createCannonBulletEntity(tower_type,tower_level, w_pos, w_dst_pos, enemyID);\n            this.bulletEntityList.push(entity);\n        }\n        else if(TowerType.Infantry==tower_type){\n            let entity:InfantryActor=await ECSFactory.getInstance().createInfantryActor(tower_type,tower_level, w_pos, w_dst_pos, enemyID);\n            this.actorEntityList.push(entity);\n        }\n        else if(TowerType.Warlock==tower_type){\n            let entity:BulletEntity=await ECSFactory.getInstance().createWarlockBulletEntity(tower_type,tower_level, w_pos, w_dst_pos, enemyID);\n            this.bulletEntityList.push(entity);\n        }\n    }\n\n    async createTowerEntity(tower_type:number,world_pos:cc.Vec2){\n        if(TowerType.Arrow==tower_type){\n            let entity:TowerEntity=await ECSFactory.getInstance().createArrowEntity(world_pos);\n\n            this.towerEntityList.push(entity);\n        }\n        else if(TowerType.Cannon==tower_type){\n            let entity:TowerEntity=await ECSFactory.getInstance().createCannonEntity(world_pos);\n\n            this.towerEntityList.push(entity);\n        }\n        else if(TowerType.Infantry==tower_type){\n            let entity:TowerEntity=await ECSFactory.getInstance().createInfantryEntity(world_pos);\n\n            this.towerEntityList.push(entity);\n        }\n        else if(TowerType.Warlock==tower_type){\n            let entity:TowerEntity=await ECSFactory.getInstance().createWarlockEntity(world_pos);\n\n            this.towerEntityList.push(entity);\n        }\n    }\n\n    async createEnemyEntity(enemy_type:number,road_data:any,actor_params:any){\n        let entity:EnemyEntity=await ECSFactory.getInstance().createEnemyEntity(enemy_type,road_data,actor_params);\n\n        this.enemyEntityList.push(entity);\n    }\n    //\n    public cleanBulletEntity(){\n        for(let i=0;i<this.bulletEntityList.length;++i){\n            if(this.bulletEntityList[i].roleComponent.isDead){\n                this.bulletEntityList[i].baseComponent.gameObject.destroy();\n                this.bulletEntityList.splice(i,1);\n                --i;\n            }\n        }\n    }\n    public cleanEnemyEntity(){\n        for(let i=0;i<this.enemyEntityList.length;++i){\n            if(this.enemyEntityList[i].roleComponent.isDead){\n                this.enemyEntityList[i].baseComponent.gameObject.destroy();\n                this.enemyEntityList.splice(i,1);\n                --i;\n            }\n        }\n    }\n    //\n    public getEnemyEntityByID(id:number):EnemyEntity{\n        for(let i=0;i<this.enemyEntityList.length;++i){\n            if(this.enemyEntityList[i].baseComponent.entityID==id){\n                return this.enemyEntityList[i];\n            }\n        }\n        return null;\n    }\n    //\n    navSystemEnemyUpdate(dt:number){\n        //敌人\n        for(let i=0;i<this.enemyEntityList.length;++i){\n            if(this.enemyEntityList[i].roleComponent.isDead){\n                continue;\n            }\n            NavSystem.getInstance().onEnemyUpdate(dt,this.enemyEntityList[i].navComponent,this.enemyEntityList[i].baseComponent,this.enemyEntityList[i].transformComponent);\n        }\n        //兵站士兵\n        for(let i=0;i<this.actorEntityList.length;++i){\n            if(this.actorEntityList[i].roleComponent.isDead){\n                continue;\n            }\n            NavSystem.getInstance().onActorUpdate(dt,this.actorEntityList[i].navComponent,this.actorEntityList[i].baseComponent,this.actorEntityList[i].transformComponent);\n        }\n    }\n\n    async AISystemTower(dt:number){\n        for(let i=0;i<this.towerEntityList.length;++i){\n            let towerAttackComponent=this.towerEntityList[i].attackComponent;\n            if(towerAttackComponent.enemyID>0){\n                continue;\n            }\n\n            towerAttackComponent.activeTime-=dt;\n            if(towerAttackComponent.activeTime>0){\n                continue;\n            }\n\n            for(let j=0;j<this.enemyEntityList.length;++j){\n                if(this.enemyEntityList[j].roleComponent.isDead){\n                    continue;\n                }\n\n                AISystem.getInstance().onTowerUpdate(dt,this.towerEntityList[i].animateComponent,this.towerEntityList[i].roleComponent,\n                    towerAttackComponent,this.towerEntityList[i].baseComponent,\n                    this.enemyEntityList[j].transformComponent,this.enemyEntityList[j].baseComponent);\n            }\n        }\n\n        for(let i=0;i<this.actorEntityList.length;++i){\n            this.actorEntityList[i].aiComponent.thinkTime-=dt;\n            if(this.actorEntityList[i].aiComponent.thinkTime>0){\n                continue;\n            }\n\n            for(let j=0;j<this.enemyEntityList.length;++j){\n                if(this.enemyEntityList[j].roleComponent.isDead){\n                    continue;\n                }\n\n                await AISystem.getInstance().onInfantryActorUpdate(dt,this.actorEntityList[i].aiComponent,this.actorEntityList[i].baseComponent,\n                    this.enemyEntityList[j].unitComponent,this.enemyEntityList[j].baseComponent,this.enemyEntityList[j].roleComponent);\n            }\n        }\n    }\n\n    attackSystemTower(dt:number){\n        for(let i=0;i<this.towerEntityList.length;++i){\n            let tower=this.towerEntityList[i];\n            if(tower.attackComponent.enemyID>0){\n                if(6666==tower.attackComponent.enemyID){\n                    AttackSystem.getInstance().createInfantryActorUpdate(dt,tower.attackComponent,tower.baseComponent,tower.roleComponent);\n                }\n                else{\n                    let enemy=this.getEnemyEntityByID(tower.attackComponent.enemyID);\n                    if(enemy&&!enemy.roleComponent.isDead){\n                        AttackSystem.getInstance().onTowerUpdate(dt,tower.attackComponent,tower.baseComponent,tower.roleComponent);\n                    }\n                }\n            }\n        }\n    }\n\n    async animateSystemBullet(dt:number){\n        for(let i=0;i<this.bulletEntityList.length;++i){\n            let bullet=this.bulletEntityList[i];\n            if(bullet.roleComponent.isDead){\n                continue;\n            }\n\n            if(bullet.animateComponent.state==AnimateState.Start||bullet.animateComponent.state==AnimateState.Playing){\n                await AnimateSystem.getInstance().onBulletUpdate(dt,bullet.roleComponent,bullet.animateComponent,bullet.attackComponent,bullet.baseComponent);\n            }\n        }\n    }\n\n    async animateSystemArrow(dt:number){\n        for(let i=0;i<this.towerEntityList.length;++i){\n            let tower=this.towerEntityList[i];\n            if(tower.roleComponent.isDead){\n                continue;\n            }\n            if(tower.animateComponent.state==AnimateState.Start||tower.animateComponent.state==AnimateState.Playing){\n                await AnimateSystem.getInstance().onTowerUpdate(dt,tower.roleComponent,tower.animateComponent,tower.baseComponent,tower.attackComponent);\n            }\n        }\n    }\n\n    async update (dt) {\n        //敌军导航\n        this.navSystemEnemyUpdate(dt);\n        //塔的AI\n        await this.AISystemTower(dt);\n        //\n        this.attackSystemTower(dt);\n        //\n        await this.animateSystemBullet(dt);\n        await this.animateSystemArrow(dt);\n        //\n        this.cleanBulletEntity();\n        this.cleanEnemyEntity();\n    }\n}\n"]}